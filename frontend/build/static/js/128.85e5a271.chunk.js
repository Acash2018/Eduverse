"use strict";(self.webpackChunkeduverse=self.webpackChunkeduverse||[]).push([[128],{4128:(s,e,a)=>{a.r(e),a.d(e,{default:()=>n});var t=a(5043),c=a(579);const n=()=>{const[s,e]=(0,t.useState)([]),[a,n]=(0,t.useState)(""),[i,r]=(0,t.useState)(null),[l,d]=(0,t.useState)(""),[h,m]=(0,t.useState)([]);(0,t.useEffect)((()=>{(async()=>{try{const s=await fetch("/api/chats"),a=await s.json();e(a)}catch(s){console.error("Error fetching chats:",s)}})()}),[]);return(0,c.jsxs)("div",{className:"messages-container",children:[(0,c.jsxs)("div",{className:"chats-list",children:[(0,c.jsxs)("div",{className:"search-container",children:[(0,c.jsx)("input",{type:"text",placeholder:"Search users...",value:l,onChange:s=>{const e=s.target.value;d(e),e?(async s=>{try{const e=await fetch(`/api/users/search?term=${s}`),a=await e.json();m(a)}catch(e){console.error("Error searching users:",e)}})(e):m([])},className:"search-input"}),h.length>0&&(0,c.jsx)("div",{className:"search-results",children:h.map((a=>(0,c.jsxs)("div",{className:"search-result-item",onClick:()=>(async a=>{try{if(!s.find((s=>s.id===a.id))){const s=await fetch("/api/chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id})}),t=await s.json();e((s=>[...s,t]))}r(s.find((s=>s.id===a.id))||a),d(""),m([])}catch(t){console.error("Error starting new chat:",t)}})(a),children:[(0,c.jsx)("img",{src:a.avatar,alt:a.name,className:"user-avatar"}),(0,c.jsx)("span",{children:a.name})]},a.id)))})]}),(0,c.jsx)("h2",{children:"Messages"}),(0,c.jsx)("div",{className:"chats-scroll",children:s.map((s=>(0,c.jsxs)("div",{className:"chat-item "+((null===i||void 0===i?void 0:i.id)===s.id?"active":""),onClick:()=>r(s),children:[(0,c.jsx)("img",{src:s.avatar,alt:s.name,className:"user-avatar"}),(0,c.jsxs)("div",{className:"chat-info",children:[(0,c.jsxs)("div",{className:"chat-header",children:[(0,c.jsx)("span",{className:"chat-name",children:s.name}),(0,c.jsx)("span",{className:"last-active",children:s.lastActive})]}),s.messages.length>0&&(0,c.jsx)("p",{className:"last-message",children:s.messages[s.messages.length-1].text})]})]},s.id)))})]}),(0,c.jsx)("div",{className:"chat-window",children:i?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"chat-header",children:[(0,c.jsx)("img",{src:i.avatar,alt:i.name,className:"user-avatar"}),(0,c.jsxs)("div",{className:"header-info",children:[(0,c.jsx)("h3",{children:i.name}),(0,c.jsx)("span",{className:"status",children:i.lastActive})]})]}),(0,c.jsx)("div",{className:"chat-messages",children:i.messages.map(((s,e)=>(0,c.jsx)("div",{className:"chat-message "+("me"===s.sender?"sent":"received"),children:(0,c.jsxs)("div",{className:"message-content",children:[(0,c.jsx)("p",{children:s.text}),(0,c.jsx)("span",{className:"timestamp",children:s.timestamp})]})},e)))}),(0,c.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),a&&i)try{const s=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:i.id,text:a})}),t=await s.json();e((s=>s.map((s=>s.id===i.id?{...s,messages:[...s.messages,t]}:s)))),n("")}catch(t){console.error("Error sending message:",t)}},className:"message-input",children:[(0,c.jsx)("input",{type:"text",value:a,onChange:s=>n(s.target.value),placeholder:"Type a message..."}),(0,c.jsx)("button",{type:"submit",children:"Send"})]})]}):(0,c.jsxs)("div",{className:"no-chat-selected",children:[(0,c.jsx)("h3",{children:"Welcome to Messages"}),(0,c.jsx)("p",{children:"Select a chat to start messaging or search for new people to connect with!"})]})})]})}}}]);
//# sourceMappingURL=128.85e5a271.chunk.js.map